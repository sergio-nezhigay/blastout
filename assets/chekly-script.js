!function(){const t={cfg:{dataAttrAppUrl:"data-chekly-url",dataAttrCheckout:"chekly-procceded",dataAttrCustomDomain:"data-checkout-domain",dataAttrCheckoutTheme:"data-chekly-theme",defaultAppBaseUrl:"https://chekly-app.com",domainPath:"checkout"},vars:{checkoutDomain:null,isCheckoutProcessing:!1},cartApi:{clearCart:()=>fetch("/cart/clear.js",{method:"POST",credentials:"same-origin"}),addToCart:t=>fetch("/cart/add.js",{method:"POST",credentials:"same-origin",body:"FORM"===t.nodeName?new FormData(t):t})},helpers:{debounce(t,e){let o=!1;return function(){o||(o=!0,setTimeout((()=>{t.apply(this,arguments),o=!1}),e))}},isChild(t,e){let o=e.parentNode;for(;o;){if(o===t)return!0;o=o.parentNode}return!1},addWrapperListener(e,o,n){e.addEventListener&&window.addEventListener(o,(o=>{(o.target===e||t.helpers.isChild(e,o.target))&&(o.stopImmediatePropagation(),o.preventDefault(),n())}),!0)},getCookie(t){const e=document.cookie.match(new RegExp("(?:^|; )"+t.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return e?decodeURIComponent(e[1]):void 0},setCookie(t,e){const o=new Date(Date.now()+18e5).toUTCString();document.cookie=`${t}=${e}; expires=${o}; path=/;`},setCookieWithExpire(t,e,o){const n=new Date(Date.now()+864e5*o).toUTCString();document.cookie=`${t}=${e}; expires=${n}; path=/;`},getGoogleAnalyticsLinkerParam(){try{let e="";const o=t.helpers.getGoogleAnalyticsLinkerParam;if("string"==typeof o.__CACHE)return e=o.__CACHE,e;try{const t=new URLSearchParams(window.location.search).get("_gl");if(t)return e=`_gl=${t}`,o.__CACHE=e,e}catch{}try{if("undefined"!=typeof gtag&&Array.isArray(window.dataLayer)){const t=window.dataLayer.find((t=>Array.isArray(t)&&"config"===t[0]&&"string"==typeof t[1]&&t[1].startsWith("G-")));if(t){const e=t[1];o.__PENDING||(o.__PENDING=!0,setTimeout((()=>{try{gtag("get",e,"linker_param",(t=>{o.__PENDING=!1,t&&"string"==typeof t&&t.includes("_gl=")&&(o.__CACHE=t)}))}catch{o.__PENDING=!1}}),0))}}}catch{}return e}catch(t){return console.warn("Error getting GA linker param:",t),""}}},dom:{selectors:{checkoutForm:'form[action^="/cart"]:not([action^="/cart/"]), form[action="/checkout"], form[action="/a/checkout"]',checkoutButton:'[name="checkout"],[name="Checkout"],[class*="opcCheckout"],[class*="checkout-btn"],[class*="btn-checkout"],[class*="checkout-button"],[class*="button-checkout"],[class*="carthook_checkout"],[type*="submit"][class*="action_button"]:not([name*="add"]),[href*="/checkout"][class*="action_button"],[id*="checkout"],[id*="Checkout"],[id*="checkout-button"],[id*="checkout-btn"]',directCheckoutLink:'a[href^="/checkout"],[onclick*="/checkout"],a[href*="/checkout"]',addToCartForm:'form[action^="/cart/add"]',returnToField:'input[name="return_to"][value*="checkout"]',buyNowForm:'form[action^="/cart/add"][data-skip-cart="true"]',checkoutUpdateButton:'[type="submit"][name="update"]',dynamicPaymentButton:'[data-shopify="payment-button"] button,[data-shopify="payment-button"] .shopify-payment-button__button',dynamicPaymentButtonContainer:'[data-shopify="payment-button"]'},getCheckoutForms:()=>document.querySelectorAll(t.dom.selectors.checkoutForm),getCheckoutButtons:()=>document.querySelectorAll(t.dom.selectors.checkoutButton),getCheckoutLinks:()=>document.querySelectorAll(t.dom.selectors.directCheckoutLink),getBuyItNowForms(){const e=[...document.querySelectorAll(t.dom.selectors.buyNowForm)];return document.querySelectorAll(t.dom.selectors.returnToField).forEach((t=>{const o=t.closest("form");o&&e.filter((t=>o.isSameNode(t))).length<=0&&e.push(o)})),e},getAddToCartForm:()=>document.querySelector(t.dom.selectors.addToCartForm),getDynamicPaymentButtons:()=>document.querySelectorAll(t.dom.selectors.dynamicPaymentButton),getUpdateCartButtons:()=>document.querySelectorAll(t.dom.selectors.checkoutUpdateButton),getDynamicPaymentButtonContainer:()=>document.querySelector(t.dom.selectors.dynamicPaymentButtonContainer)},functions:{getAppBaseUrl(){const e=document.querySelector("["+t.cfg.dataAttrAppUrl+"]"),o=e.getAttribute(t.cfg.dataAttrCustomDomain),n=e.getAttribute(t.cfg.dataAttrAppUrl),r=t.cfg.defaultAppBaseUrl;return o||n||r},getCheckoutTheme:()=>document.querySelector("["+t.cfg.dataAttrAppUrl+"]").getAttribute(t.cfg.dataAttrCheckoutTheme)||!1,getOriginUrl:()=>window.location.origin,getCartToken:()=>t.helpers.getCookie("cart"),getStoreName:()=>window.Shopify&&window.Shopify.shop?window.Shopify.shop:"",getStoreActieCurrency:()=>window.Shopify.currency.active,getStoreCountry:()=>window.Shopify.country,getStoreActiveCurrencyRate:()=>window.Shopify.currency.rate,getStoreRootRoute:()=>window.Shopify.routes.root,getUserName:()=>window.Shopify.customer?window.Shopify.customer.firstName:null,getUserLastName:()=>window.Shopify.customer?window.Shopify.customer.lastName:null,getUserEmail:()=>window.Shopify.customer?window.Shopify.customer.email:null,getUserPhone:()=>window.Shopify.customer?window.Shopify.customer.phone:null,submitBuyNowForm(e){let o=e.closest("form")||t.dom.getAddToCartForm();if(o){if(!o.querySelector('[name="quantity"]')){const t=document.createElement("input");t.type="hidden",t.name="quantity",t.value="1",o.appendChild(t)}if(!o.querySelector('input[name="return_to"]')){const t=document.createElement("input");t.type="hidden",t.name="return_to",t.value="/checkout",o.appendChild(t)}t.cartApi.clearCart().then((()=>t.cartApi.addToCart(o))).then((()=>t.functions.processCheckout()))}},processCheckout(){if(t.vars.isCheckoutProcessing)return;t.vars.isCheckoutProcessing=!0;const e=t.functions.getAppBaseUrl(),o=t.functions.getCartToken(),n=t.functions.getOriginUrl().replace(/^https?:\/\//,""),r=t.functions.getStoreRootRoute(),c=t.functions.getStoreName(),a=t.functions.getStoreActiveCurrencyRate(),i=t.functions.getCheckoutTheme(),s=t.functions.getUserName()||null,u=t.functions.getUserLastName()||null,d=t.functions.getUserEmail()||null,m=t.functions.getUserPhone()||null,l=new URLSearchParams(window.location.search);let h={};try{h=JSON.parse(t.helpers.getCookie("chekly_tracking")||"{}")}catch(t){}const p=t=>l.get(t)||h[t]||"";console.log("Current URL params:",window.location.search),console.log("Saved tracking params:",h);const g=p("utm_campaign"),f=p("utm_medium"),k=p("utm_source"),y=p("utm_content"),C=p("utm_term"),_=p("utm_id");console.log("UTM params:",{utm_campaign:g,utm_medium:f,utm_source:k,utm_content:y,utm_term:C,utm_id:_}),g&&g.includes("__CAMPAIGN_NAME__")&&console.warn("TikTok macro __CAMPAIGN_NAME__ not expanded:",g),_&&_.includes("__CAMPAIGN_ID__")&&console.warn("TikTok macro __CAMPAIGN_ID__ not expanded:",_);const w=p("fbclid"),A=p("ttclid"),b=p("epik"),S=p("ScCid"),U=t.helpers.getCookie("_fbp"),$=t.helpers.getCookie("_fbc"),N=t.helpers.getCookie("_ttp"),P=t.helpers.getCookie("_shopify_sa_p"),E=(navigator.languages&&navigator.languages[0])?.slice(0,2)||navigator.language.slice(0,2),I=[g?`utm_campaign=${encodeURIComponent(g)}`:"",f?`utm_medium=${encodeURIComponent(f)}`:"",k?`utm_source=${encodeURIComponent(k)}`:"",y?`utm_content=${encodeURIComponent(y)}`:"",C?`utm_term=${encodeURIComponent(C)}`:"",_?`utm_id=${encodeURIComponent(_)}`:"",w?`fbclid=${encodeURIComponent(w)}`:"",A?`ttclid=${encodeURIComponent(A)}`:"",b?`epik=${encodeURIComponent(b)}`:"",S?`sccid=${encodeURIComponent(S)}`:"",$?`_fbc=${encodeURIComponent($)}`:"",U?`_fbp=${encodeURIComponent(U)}`:"",N?`ttp=${encodeURIComponent(N)}`:"",E?`utm_lang=${E}`:"",P||""].filter(Boolean).join("&");if(e&&o&&n){let l=`${e}/checkout/?storeName=${n}&cartToken=${o}&curRate=${a}${i?`&theme=${i}`:""}&shopifyDomain=${c}${r.length>2?"&subFolder="+r.replace(/\//g,""):""}`;const h=[];null!==s&&h.push(`user_name=${s}`),null!==u&&h.push(`user_lastname=${u}`),null!==d&&h.push(`user_email=${d}`),null!==m&&h.push(`user_phone=${m}`),h.length&&(l+="&"+h.join("&"));const p=t.helpers.getGoogleAnalyticsLinkerParam();p?console.log("GA Linker param added:",p):console.warn("GA Linker param not found - cross-domain tracking may not work properly");let g=l;I&&(g+=`&${I}`),p&&(g+=`&${p}`),window.location=g}else window.location="/checkout"},addHandlers(){const e=t.dom.getCheckoutForms(),o=t.dom.getCheckoutLinks(),n=t.dom.getCheckoutButtons(),r=t.dom.getBuyItNowForms(),c=t.dom.getUpdateCartButtons();[...e].forEach((e=>{"true"!==e.getAttribute(t.cfg.dataAttrCheckout)&&(t.helpers.addWrapperListener(e,"submit",(()=>{t.functions.processCheckout()})),e.setAttribute(t.cfg.dataAttrCheckout,"true"))})),[...o,...n].forEach((e=>{"true"!==e.getAttribute(t.cfg.dataAttrCheckout)&&(["mousedown","touchstart","click"].forEach((o=>t.helpers.addWrapperListener(e,o,(()=>{t.functions.processCheckout()})))),e.setAttribute(t.cfg.dataAttrCheckout,"true"))})),[...r].forEach((e=>{"true"!==e.getAttribute(t.cfg.dataAttrCheckout)&&(t.helpers.addWrapperListener(e,"submit",(()=>{t.functions.submitBuyNowForm(e)})),e.setAttribute(t.cfg.dataAttrCheckout,"true"))})),[...c].forEach((e=>{"true"!==e.getAttribute(t.cfg.dataAttrCheckout)&&(t.helpers.addWrapperListener(e,"click",(()=>{e.closest("form").submit()})),e.setAttribute(t.cfg.dataAttrCheckout,"true"))}))},addDynamicButtonHandlers(){[...t.dom.getDynamicPaymentButtons()].forEach((e=>{t.helpers.addWrapperListener(e,"click",(()=>{t.functions.submitBuyNowForm(e)}))}))},reInit(){t.functions.addDynamicButtonHandlers(),t.functions.addHandlers()},init(){const e=new URLSearchParams(window.location.search),o={};let n=!1;["utm_campaign","utm_medium","utm_source","utm_content","utm_term","utm_id","fbclid","ttclid","epik","ScCid","gclid"].forEach((t=>{const r=e.get(t);r&&(o[t]=r,n=!0)})),n&&t.helpers.setCookieWithExpire("chekly_tracking",JSON.stringify(o),7),t.functions.reInit(),document.addEventListener("DOMContentLoaded",(()=>{t.functions.reInit()})),window.addEventListener("load",(()=>{t.functions.reInit();const e=t.helpers.debounce((()=>t.functions.reInit()),500);new MutationObserver((()=>e())).observe(window.document,{attributes:!0,childList:!0,subtree:!0})})),window.addEventListener("pageshow",(e=>{t.vars.isCheckoutProcessing=!1,t.functions.reInit()})),window.addEventListener("focus",(()=>{t.vars.isCheckoutProcessing&&(t.vars.isCheckoutProcessing=!1)})),window.addEventListener("popstate",(()=>{t.vars.isCheckoutProcessing=!1})),document.addEventListener("visibilitychange",(()=>{!document.hidden&&t.vars.isCheckoutProcessing&&(t.vars.isCheckoutProcessing=!1)}))}}};t.functions.init()}();